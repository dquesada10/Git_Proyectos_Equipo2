---
title: "EDA del Dataset del Cancer de Mama"
author: "Autores: Laura Martín, Desiderio Nevado y Daniel Quesada"
date: "Fecha de la publicación: `r Sys.Date()`"
output: html_document
---



# Contexto
El dataset objeto de este Exploratory Data Analysis (EDA) es una muestra de mujeres pacientes de cáncer de mama diagnoticadas entre 2006 y 2010. Fue publicado por el programa SEER (Surveillance, Epidemiology and End Results Program) del NCI (National Cancer Institute) en noviembre de 2017.

[Para saber más de NCI](https://www.cancer.gov/about-nci/overview)

[Para saber más del programa SEER](https://seer.cancer.gov/about/overview.html)

Se han excluido de la muestra los pacientes con un tamaño de tumor desconocido o únicamente con ganglios linfaticos examinados y los pacientes que llevaban menos de un mes de supervivencia.

Este dataset ha sido recogido de Kaggle. Se encuentra en la siguiente dirección:

[Dataset Breast Cancer](https://www.kaggle.com/datasets/reihanenamdari/breast-cancer)

<center>
![](https://www.sysmex.es/fileadmin/_processed_/a/9/csm_LifeScience_StageImage_BreastCancer_1500x600-01_2498abd1e0.jpg){width=80%}
</center>

# Descripción de las variables
Kaggle proporciona un diccionario de las variables para el mejor entendimiento del Dataset:

* **Race**: recoge la raza de las mujeres del dataset. Se divide "white", "black" y "other".

* **Marital Status**: Representa el estado civil de la mujer. Puede tomar los valores de "Married", "Divorced", "Single", "Windowed" o "Separated".

* **T Stage**: La T representa el tamaño y la extension del tumor principal (T de tumor). Puede tomar los valores T1, T2, T3 y T4. Cuanto más grande el número, mayor es el tumor. Si es T1 el tumor es de 2 cm o menos. Si es T2 entonces entre 2 y 5 cm. Si es T3 entonces más de 5 cms. Si es T4 ya se extiende a la piel y a la pared torácica.

* **N Stage**: N se refiere al número de ganglios linfáticos que tienen cancer. Por ello, N1, N2 y N3 se refieren al número de ganglios linfáticos que tienen cáncer.

<center>
![Estados N, T y M](https://epomedicine.com/wp-content/uploads/2016/08/tnm-breast.jpg){width=50%}
</center>

* **6th Stage**: Estado tumoral combinando las clasificaciones de T, N y M (si el tumor está en metastasis), el grado del tumor y los resultados de las pruebas de ER/PR y HER2. Esta información ayuda a saber la diagnosis. Los médicos se refieres a los estados de I a IIA como "estado temprano" y del IIB al III como "avanzado localmente".

<center>
![6th Stage](https://pubs.rsna.org/cms/10.1148/rg.2018180056/asset/images/medium/rg.2018180056.tbl4.gif)
</center>

* **Differentiate**: Toma los valores de "Moderately differentiated", "Poorly dufferebtuated", "Undifferentiated" y "Well differentiated" Carcinomas bien diferenciados tienden a no crecer rapidamente.

* **Grade**: Un grado bajo (1) significa que el cáncer crece lento y es menos probable que crezca y la mayoria de células parecen normales. Un grado alto (3) supone que el cáncer es mucho más probable que crezca y se observan muchas células no normales. Un grado 2 sería algo intermedio entre los dos.

<center>
![Grados de cáncer](https://hips.hearstapps.com/hmg-prod.s3.amazonaws.com/images/gh-breastcancer-gradesofcancer-1540482662.jpg?crop=1xw:1xh;center,top&resize=480:*)
</center>


* **A Stage**: Puede tomar el valor de "Regional" o "Distant". El primero abarcaría los estados I y II y significa que el cancer se ha extendido del pecho a estructuras próximas y ganglios linfáticos. El segundo son los estados III y IV yt significa que se ha extendidos a partes distantes del cuerpo como los pulmones, el hígado y los huesos.
Regional: The cancer has spread outside the breast to nearby structures or lymph nodes.

* **Tumor Size**: Es el tamaño del tumor.

* **Estrogen Status**: Toma los valores de Positivo y Negativo. Si es positivo el cancer crece mas rápido y significa que las células cancerígenas tienen receptores de estrógeno.

* **Progesterone Status**: Toma los valores de Positivo y Negativo. Si es positivo el cancer crece mas rápido y significa que las células cancerígenas tienen receptores de progesterone. Tratamientos con terapia endocrina bloquea el crecimiento de las células cancerosas.

* **Regional Node Examined**: Número de nodos linfáticos examinados.

* **Regional Node Positive**: Número de nodos linfáticos positivos.

* **Survival Months**: Meses que ha sobrevivido el paciente.

* **Status**: Toma los valores de "Alive" y "Dead"

<span style="text-decoration:underline">Explicación variables Estrogen Status y Progesterone Status:</span>

A las células cancerosas del seno obtenidas durante una biopsia o cirugía se le realizarán pruebas para saber si tienen determinadas proteínas que son receptores de estrógeno o progesterona. 
Cuando las hormonas estrógeno y progesterona se unen a estos receptores, estimulan el crecimiento del cáncer. 
A los cánceres se les identifica como cánceres con receptores de hormonas positivos o cánceres con receptores de hormonas negativos según tengan o no estos receptores (proteínas). Saber el estado del receptor hormonal es importante para decidir las opciones de tratamiento.




#Análisis

Lo primero importamos ciertas librerias que nos pueden ser utiles:
```{r}
library(dplyr)
library(ggplot2)
library(ggcorrplot)
library(fBasics)
library(tidyr)
```
Definimos algunas funciones que nos van a ser utiles:
```{r}
Cv <- function(mean, sd){
      (sd/mean)*100
      }
```


```{r}
Breast_Cancer<- read.csv('Breast_Cancer.csv')
head(Breast_Cancer)
```

```{r}
str(Breast_Cancer)
```
Como se observar de las 16 variables del dataset hay 5 variables integer y el resto son categóricas pero las ha importado como caracter. Además, se puede observar que la variable Reginol.Node.Positive está mal escrita así que vamos a renombrarla.

```{r}
Breast_Cancer<-rename(Breast_Cancer,Regional.Node.Positive=Reginol.Node.Positive)
str(Breast_Cancer)
```
Ahora vamos a convertir las varibles chr en factores:
```{r}
Breast_Cancer[sapply(Breast_Cancer, is.character)] <- lapply(Breast_Cancer[sapply(Breast_Cancer, is.character)],as.factor)
str(Breast_Cancer)
```
Con las variables bien categorizadas como factores podemos ver su distribución:
```{r}
summary(Breast_Cancer)
```
A simple vista se puede observar lo siguiente:

* No hay N/As en los registros.

```{r}
sapply(Breast_Cancer, function(x) sum(is.na(x)))
```

* La edad media es de 54 años y casi todas están entre 50 y 60 años
* Son mujeres casada en su mayoria
* De media han sobrevivido 6 años y la mayoria están vivas
* El grado del cancer en general es 2 o 3 pero la mayoria esta en unos estados más iniciales y a apenas se les ha extendido por partes distantes del cuerpo 


Vamos a separar las variables numéricas de las categóricas

```{r}
Breast_Cancer.num <- Breast_Cancer[,names(which(sapply(Breast_Cancer, is.numeric)))]
colnames(Breast_Cancer.num)
```
```{r}
Breast_Cancer.cat <- Breast_Cancer[,names(which(sapply(Breast_Cancer, is.factor)))]
colnames(Breast_Cancer.cat)
```


```{r}
ncol(Breast_Cancer.num)
ncol(Breast_Cancer.cat)
```


## Analisis variables numéricas

Primero generamos un boxplot para todas ellas:
```{r}
boxplot(Breast_Cancer.num, main = 'Boxplots variables continuas',
        ylab = "conteo",col = 'ghostwhite')
```
Miramos histogramas y boxplot para cada una de ellas:
```{r}
for(i in 1:ncol(Breast_Cancer.num))
{
x<-colnames(Breast_Cancer.num)[i]
print(ggplot(Breast_Cancer.num, aes(x = get(x))) +
  geom_density() +
  ggtitle(x))
print(
  boxplot(Breast_Cancer.num[,i], main = paste("Boxplot de",x),ylab = x)
  )
}
```

Ahora si nos centramos unicamente en la edad:
```{r}
summary(Breast_Cancer$Age)
sd(Breast_Cancer$Age)
Cv(mean(Breast_Cancer$Age), sd(Breast_Cancer$Age))
```
```{r}
x<-"Age"
ggplot(Breast_Cancer, aes(x = get(x))) +
  geom_density() +
  ggtitle(x)
ggplot(Breast_Cancer, aes(x = get(x))) +
  geom_histogram(fill="white", colour="black",bins=10) +
  ggtitle(x)
```

Analizamos si la variable Edad sigue una normal:
```{r}
normalTest(Breast_Cancer$Age, method = c("sw", "jb"))
qqnorm(Breast_Cancer$Age, pch = 1, frame = FALSE)
qqline(Breast_Cancer$Age, col = "steelblue", lwd = 2)
```
Se observa que no tiene mucha normalidad. Probamos con el logaritmo:
Analizamos si la variable Edad sigue una normal:
```{r}
normalTest(log10(Breast_Cancer$Age), method = c("sw", "jb"))
qqnorm(log10(Breast_Cancer$Age), pch = 1, frame = FALSE)
qqline(log10(Breast_Cancer$Age), col = "steelblue", lwd = 2)
```
Se sigue observando que no tiene normalidad la variable.

Lo vemos por la variable categórica Race
```{r}
y<-colnames(Breast_Cancer.cat)[1]
lables <-levels(Breast_Cancer[,y])
names(Breast_Cancer.cat[1]) 
total<-length(Breast_Cancer[,x])

Breast_Cancer %>%
  mutate(Race = factor(get(y) , labels = levels(Breast_Cancer[,y]))) %>%
  ggplot(aes(x = get(x), fill = get(y))) +
  geom_density(alpha = .3) +
  ggtitle(x)

Breast_Cancer %>%
  mutate(Race = factor(get(y) , labels = levels(Breast_Cancer[,y]))) %>%
  ggplot(aes(x = get(y), y = get(x))) +
  geom_violin(aes(fill = Race)) +
  ggtitle(x)

Breast_Cancer %>%
   summarise(conteo=length(get(x)),porc=length(get(x))/total,media=mean(get(x)),median=median(get(x)),desv_tip=sd(get(x)),CoV=Cv(mean(get(x)),sd(get(x))))

Breast_Cancer %>%
   group_by(Race) %>%
   summarise(conteo=length(get(x)),porc=length(get(x))/total,media=mean(get(x)),median=median(get(x)),desv_tip=sd(get(x)),CoV=Cv(mean(get(x)),sd(get(x))))
```
Se observa que las mujeres de raza blanca son más mayores y están algo más menos dispersos. Sin embargo, las mujeres de la muestra de raza negra y sobre todo de "Other" son más jóvenes. En cualquier caso, las mujeres de raza blanca son la clara mayoria.

Lo vemos por la variable categorica Marital Status
```{r}
y<-colnames(Breast_Cancer.cat)[2]
y
lables <-levels(Breast_Cancer[,y])
total<-length(Breast_Cancer[,x])

Breast_Cancer %>%
  mutate(Marital.Status = factor(get(y) , labels = levels(Breast_Cancer[,y]))) %>%
  ggplot(aes(x = get(x), fill = Marital.Status)) +
  geom_density(alpha = .3) +
  ggtitle(x)

Breast_Cancer %>%
  mutate(Marital.Status = factor(get(y) , labels = levels(Breast_Cancer[,y]))) %>%
  ggplot(aes(x = get(y), y = get(x))) +
  geom_violin(aes(fill = Marital.Status)) +
  ggtitle(x)

Breast_Cancer %>%
   summarise(conteo=length(get(x)),porc=length(get(x))/total,media=mean(get(x)),median=median(get(x)),desv_tip=sd(get(x)),CoV=Cv(mean(get(x)),sd(get(x))))

Breast_Cancer %>%
   group_by(Marital.Status) %>%
   summarise(conteo=length(get(x)),porc=length(get(x))/total,media=mean(get(x)),median=median(get(x)),desv_tip=sd(get(x)),CoV=Cv(mean(get(x)),sd(get(x))))
```
Lo vemos por la variable categorica Marital Status
```{r}
y<-colnames(Breast_Cancer.cat)[3]
y
lables <-levels(Breast_Cancer[,y])

Breast_Cancer %>%
  mutate(Marital.Status = factor(get(y) , labels = levels(Breast_Cancer[,y]))) %>%
  ggplot(aes(x = get(x), fill = Marital.Status)) +
  geom_density(alpha = .3) +
  ggtitle(x)

Breast_Cancer %>%
  mutate(Marital.Status = factor(get(y) , labels = levels(Breast_Cancer[,y]))) %>%
  ggplot(aes(x = get(y), y = get(x))) +
  geom_violin(aes(fill = Marital.Status)) +
  ggtitle(x)
```


La variables categoricas las convertimos en numericas para poder trabajar mejor
```{r}
Breast_Cancer.cat.final <- sapply(Breast_Cancer.cat,unclass)
head(Breast_Cancer.cat.final)
```
Sacamos el mapeo entre el valor numerico dado a la variable categorica y su nivel
```{r}
for(i in 1:ncol(Breast_Cancer.cat))
{
x<-colnames(Breast_Cancer.cat)[i]
print(with(Breast_Cancer.cat,data.frame(code=seq_along(levels(get(x))),levels=levels(get(x)))))
}
```




```{r}
#table(Breast_Cancer$Status)
prop.table(table(Breast_Cancer$Status))
#table(Breast_Cancer$Status,Breat_Cancer$Race)
```

```{r}
#boxplot(Breast_Cancer$Age)
hist(Breast_Cancer$Age)
```


```{r}
dim(Breast_Cancer)
```



https://github.com/carmenlancho/MDS
Iris_sinlogo ->raw->



