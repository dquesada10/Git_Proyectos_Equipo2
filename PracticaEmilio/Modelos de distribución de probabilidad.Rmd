---
title: "Práctica 2 - Modelos de distribución de probabilidad"
author: "Daniel Quesada"
date: "2022-10-24"
output: html_document
---


Importamos las librerias y guardamos el dataset
```{R }
library(PASWR2)
library(lattice)
library(ggplot2)
datos <- CHIPS
```

Analizamos a alto nivel la forma del dataset
```{R }
head(datos,5)
summary(datos)
```

## Actividad 1
* **Realiza un histograma de todas las filas de la variable number y comenta si a simple vista nos interesa separar los datos o no. Haz un gráfico de cajas y comenta qué nos cuenta sobre los datos.**

```{R }
hist(datos[,"number"],main ="Total")
```
```{R }
boxplot(datos[,"number"],main ="Total")
abline(h=mean(datos[,"number"]))
```
Observando el boxplot, la media esta ligeramente por encima de la mediana debido a dos valores atipicos que desplazan un poco la distribucion a la izquierda.
Mirando el histograma también se observa el efecto de los dos datos atipicos al desplazar la distribución.
El 50% de los valores se encuentran entre 312 y 369,8

```{R }
mean(datos[,"number"])
summary(datos[,"number"])
```

* **Crea dos conjuntos de datos diferentes para los dos métodos, por ejemplo datosI y datosII.**

Creamos los datasets
```{R }
datosI <-datos[datos$method=="techniqueI","number"]
datosII <-datos[datos$method=="techniqueII","number"]
```

* **Realiza ahora un histograma de cada uno de los tipos y comenta si te parece que los datos siguen una distribucion normal**

Creamos los histogramas de los diferentes tipos
```{R }
hist(datosI,main ="datos Tecnica I",
    # breaks = 4
    breaks = c(250,290,330,370,410,460,500)
     )
hist(datosII,main ="datos Tecnica II",
    #breaks = 5
   breaks = c(250,290,330,370,410,460,500)
     )
```
Los dos histogramas seguirían en principio distribuciones normales. En el segundo dataset habría que eliminarle los 2 datos atípicos.

* **Confirma tus conclusiones con alguna/s de las herramientas vistas en clase (test de normalidad, gráfico Quantil-Quantil, tests de normalidad, …)**

Hacemos test de normalidad para datosI pasa los tests. En el QQplot se observa que los datos siguen la distribución normal.
```{R }
library(fBasics)
normalTest(datosI, method = c("sw", "jb"))
qqnorm(datosI, pch = 1, frame = FALSE)
qqline(datosI, col = "steelblue", lwd = 2)
```

Hacemos test de normalidad para datosII y pasa los tests aunque con un p valor mas bajo debido a los dos datos atípicos como se observa en el QQplot.
```{R }
normalTest(datosII, method = c("sw", "jb"))
qqnorm(datosII, pch = 1, frame = FALSE)
qqline(datosII, col = "steelblue", lwd = 2)
```

## Actividad 2

* **Realiza una estimación puntual de la media y la desviación típica de la población del número de chips para cada método**

```{R }
library("tidyr")
library("dplyr")
datos %>%
   group_by(method) %>%
   summarise(media=mean(number),desv_tip=sd(number))
```
* **Calcula la probabilidad de que en una placa de silicio a la que se le ha aplicado el método techniqueI tomada al azar tenga más de 390 chips utilizables.**

```{R }
pnorm(390,mean(datosI),sd(datosI), lower.tail = FALSE)
```

* **Calcula la probabilidad de que en una placa de silicio a la que se le ha aplicado el método techniqueII tomada al azar tenga menos de 150 chips utilizables.**

```{R }
pnorm(150,mean(datosII),sd(datosII))
```

* **Encuentra cuál es el número máximo de chips utilizables del 3% de las plcas de silicio a las que se la han aplicado el método techniqueII del tipo B que tienen menos chips utilizables (ayuda: esto es equivalente a encontrar el cuantil 0.03 de la distribución)**

```{R }
qnorm(0.03,mean(datosII),sd(datosII))
```

## Actividad 3

**Vamos a centrarnos ahora en las placas de silicio del método techniqueII. Supongamos que un número de chips utilizables por debajo de 150 no es aceptable para el receptor de la placa de silicio. En la actividad anterior hemos calculado la probabilidad  de que esto suceda. Entonces, si tomamos una placa de silicio del método II al azar y comprobamos si tiene menos de 150 chips utilizables, estamos realizando un experimento de Bernoulli con probabilidad $p$.**

* **Calcula la probabilidad de que en un lote de 10 placas de silicio, no haya ninguna defectuosa (ayuda: distribución binomial).**

```{R }
x <-pnorm(150,mean(datosII),sd(datosII))
x
pbinom(0,10,x)
```

* **Imagina que las placas de silicio se fabrican en serie e independientemente. ¿Cuál es la probabilidad de que sean necesario examinar 10 placas de silicio para que aparezca la primera placa de silicio defectuosa? (ayuda: distribución geométrica.)**

```{R }
pgeom(10,x)
```
* **Supongamos que en una caja de 30 placas de silicio van 3 defectuosas. ¿Cuál es la probabilidad de que al tomar una muestra sin reposición de 6 placas de silicio al menos una sea defectuosa? (ayuda: distribución hipergeométrica)**

```{R }
1- phyper(0,3,27,6)
```


## Actividad 4

**Seguimos con las placas de silicio del método II, pero en vez de hacer experimentos de Bernoulli queremos estudiar el número de placas de silicio defectuosas fabricadas cada día. Supongamos que se fabrican 3000 placas de silicio cada día. Entonces, cada día en promedio se estarán produciendo aproximadamente $3000 x p$ placas de silicio, y el número de placas de silicio defectuosas por día sigue una distribución de Poisson. Tomemos 3 como ese promedio de placas de silicio defectuosas cada día. (ayuda: repasa qué modelo de distribución modeliza estos recuentos de eventos raros con una tasa media por unidad de tiempo)**

* **¿Cuál es la probabilidad de que un día se produzcan más de 5 placas de silicio defectuosas?**

```{R }
lambda <-3
1- ppois(5,lambda)
```
* **¿Cuál es la probabilidad de que un día no salga ninguna placa de silicio defectuosa de la fábrica?**

```{R }
ppois(0,lambda)
```
* **La fábrica funciona de lunes a viernes. ¿Qué distribución sigue el número de placas de silicio defectuosas por semana? Justifica qué propiedad se aplica.**

Como la distribucion tiene la propiedad aditiva entonces lambda es $3*5$ dias
```{R }
lambda_sem <- lambda*5
ppois(0,lambda_sem)
```

## Actividad 5

**El departamento de I+D de la empresa que fabrica las placas de silicio con el método II está investigando nuevos materiales y métodos para mejorar la calidad de las placas de silicio. En particular, quieren llegar a diseñar una placa de silicio cuya duración siga una distribución de Weibull con parámetros $a=9$ y $b=382$.**

* **Realiza una simulación de la producción semanal de placas de silicio (recuerda: 5 días de produccción, a 3000 placas de silicio por día). Guarda los datos en un vector.**

```{R }
produccion_sem <- 3000*5
prod_sem <- rweibull(produccion_sem,9,382)
```
* **Con este nuevo proceso, ¿se mejora realmente la duración media de las placas de silicio? (ayuda: puedes usar los datos simulados o la expresión de la esperanza de una Weibull) **

Hay una ligera mejora pero la diferencia no parece significativa
```{R }
mean(prod_sem)
mean(datosII)
```
* **Los ingenieros no lo tienen muy claro (parece que la diferencia no es tanta en promedio y los nuevos materiales son costosos). Para demostrarles que merece la pena, calcula la proporción de placas de silicio defectuosas que producirá probablemente el nuevo proceso y compárala con el anterior (la  que calculamos en la actividad 2)**

Viendo los resultados parece que sí que disminuye la probabilidad de obtener placas defectuosas
```{R }
print(paste("probabilidad defectuosa del ejercicio 2 (valores < a 150): ",pnorm(150,mean(datosII),sd(datosII))))
print(paste("probabilidad defectuosa con la mejora (valores < a 150): ",pnorm(150,mean(prod_sem),sd(prod_sem))))
```